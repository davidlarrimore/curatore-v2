# ============================================================================
# Cross-Domain Facet Definitions — Curatore Data Core
# ============================================================================
#
# Facets are user-facing filter abstractions that let users apply a single
# filter (e.g., "agency = GSA") across multiple content types, even when the
# underlying JSON path differs per type (sam.agency vs forecast.agency_name).
#
# This file defines the global baseline. Org-level overrides live in the
# `facet_definitions` and `facet_mappings` database tables.
#
# ── Field Reference ──────────────────────────────────────────────────────────
#
#   display_name       — Human-readable label shown in search filters, the
#                        admin Metadata Catalog, and MCP tool descriptions.
#
#   data_type          — Value type for the facet. Determines which operators
#                        are valid and how values are compared.
#                        Options:
#                          string  — Text values, compared case-insensitively
#                          number  — Numeric values (int or float)
#                          boolean — true / false
#                          date    — ISO 8601 date strings (YYYY-MM-DD)
#
#   description        — Explanation of what this facet filters. Shown as help
#                        text in the UI and returned by the metadata API.
#
#   has_reference_data — (Optional, default false) When true, this facet uses
#                        the reference data system (reference_data.yaml + DB)
#                        for canonical value resolution. The "Discover Values"
#                        feature on the admin Metadata page uses this to find
#                        unmapped values in the search index and suggest
#                        groupings via LLM. See reference_data.yaml.
#
#   operators          — List of filter operators the search API supports for
#                        this facet. Used by pg_search_service to build SQL.
#                        Options:
#                          eq       — Exact match (field = value).
#                                     Works with: string, number, boolean, date.
#                          in       — Match any value in a list (field IN [...]).
#                                     Works with: string, number.
#                          gte      — Greater than or equal (field >= value).
#                                     Works with: number, date.
#                          lte      — Less than or equal (field <= value).
#                                     Works with: number, date.
#                          contains — Substring / partial match (field ILIKE %value%).
#                                     Works with: string.
#                          exists   — Field is present and non-null.
#                                     Works with: any type.
#
#   mappings           — Maps content_type → namespace.field JSON path.
#                        Each key is a content_type value from search_chunks
#                        (e.g., sam_notice, asset, ag_forecast). The value is
#                        the dot-separated path into search_chunks.metadata
#                        (e.g., "sam.agency" means metadata->'sam'->>'agency').
#                        A facet only applies to content types listed here;
#                        content types without a mapping are excluded from
#                        that facet's filter.
#
# ── Content Types ────────────────────────────────────────────────────────────
#
#   sam_notice              — Individual SAM.gov notice
#   sam_solicitation        — Grouped SAM.gov solicitation
#   ag_forecast             — GSA Acquisition Gateway forecast
#   apfs_forecast           — DHS APFS forecast
#   state_forecast          — State Department forecast
#   salesforce_account      — Salesforce account record
#   salesforce_contact      — Salesforce contact record
#   salesforce_opportunity  — Salesforce opportunity record
#   asset                   — Uploaded/synced document (SharePoint, SAM, scrape)
#

facets:
  agency:
    display_name: "Agency"
    data_type: string
    description: "Federal agency name — cross-domain filter across SAM.gov, forecasts, and Salesforce"
    has_reference_data: true
    operators: [eq, in]
    mappings:
      sam_notice: "sam.agency"
      sam_solicitation: "sam.agency"
      ag_forecast: "forecast.agency_name"
      apfs_forecast: "forecast.agency_name"
      state_forecast: "forecast.agency_name"
      salesforce_account: "salesforce.account_name"
      salesforce_contact: "salesforce.account_name"
      salesforce_opportunity: "salesforce.account_name"
      asset: "sam.agency"

  naics_code:
    display_name: "NAICS Code"
    data_type: string
    description: "NAICS industry classification code"
    operators: [eq, in]
    mappings:
      sam_solicitation: "sam.naics_code"

  set_aside:
    display_name: "Set-Aside"
    data_type: string
    description: "Small business set-aside type"
    has_reference_data: true
    operators: [eq, in]
    mappings:
      sam_solicitation: "sam.set_aside"
      ag_forecast: "forecast.set_aside_type"
      apfs_forecast: "forecast.set_aside_type"
      state_forecast: "forecast.set_aside_type"

  notice_type:
    display_name: "Notice Type"
    data_type: string
    description: "SAM.gov notice type (Presolicitation, Sources Sought, etc.)"
    operators: [eq, in]
    mappings:
      sam_notice: "sam.notice_type"

  fiscal_year:
    display_name: "Fiscal Year"
    data_type: number
    description: "Federal fiscal year"
    operators: [eq, in, gte, lte]
    mappings:
      ag_forecast: "forecast.fiscal_year"
      apfs_forecast: "forecast.fiscal_year"
      state_forecast: "forecast.fiscal_year"

  award_quarter:
    display_name: "Award Quarter"
    data_type: string
    description: "Estimated award quarter"
    operators: [eq, in]
    mappings:
      ag_forecast: "forecast.estimated_award_quarter"
      apfs_forecast: "forecast.estimated_award_quarter"
      state_forecast: "forecast.estimated_award_quarter"

  folder:
    display_name: "Folder"
    data_type: string
    description: "SharePoint folder or storage folder"
    operators: [eq, in, contains]
    mappings:
      asset: "sharepoint.folder"

  site_name:
    display_name: "SharePoint Site"
    data_type: string
    description: "SharePoint site display name"
    operators: [eq, in]
    mappings:
      asset: "sharepoint.site_name"

  created_by:
    display_name: "Created By"
    data_type: string
    description: "Document creator (SharePoint author)"
    operators: [eq, in]
    mappings:
      asset: "sharepoint.created_by"

  account_type:
    display_name: "Account Type"
    data_type: string
    description: "Salesforce account type"
    operators: [eq, in]
    mappings:
      salesforce_account: "salesforce.account_type"

  industry:
    display_name: "Industry"
    data_type: string
    description: "Salesforce account industry"
    operators: [eq, in]
    mappings:
      salesforce_account: "salesforce.industry"

  stage_name:
    display_name: "Stage"
    data_type: string
    description: "Salesforce opportunity stage"
    operators: [eq, in]
    mappings:
      salesforce_opportunity: "salesforce.stage_name"

  opportunity_type:
    display_name: "Opportunity Type"
    data_type: string
    description: "Salesforce opportunity type"
    operators: [eq, in]
    mappings:
      salesforce_opportunity: "salesforce.opportunity_type"

  collection_name:
    display_name: "Scrape Collection"
    data_type: string
    description: "Web scrape collection name"
    operators: [eq, in]
    mappings:
      asset: "scrape.collection_name"

  file_extension:
    display_name: "File Type"
    data_type: string
    description: "File extension"
    operators: [eq, in]
    mappings:
      asset: "file.extension"

  forecast_source:
    display_name: "Forecast Source"
    data_type: string
    description: "Forecast data source type"
    operators: [eq, in]
    mappings:
      ag_forecast: "forecast.source_type"
      apfs_forecast: "forecast.source_type"
      state_forecast: "forecast.source_type"

  document_type:
    display_name: "Document Type"
    data_type: string
    description: "Document classification — Proposal, Solicitation, White Paper, etc."
    operators: [eq, in]
    mappings:
      asset: "file.document_type"
