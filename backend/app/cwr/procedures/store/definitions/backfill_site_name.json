{
  "name": "Backfill SharePoint Site Name - Past Performances Folder",
  "slug": "backfill_site_name",
  "tags": [
    "sharepoint",
    "backfill",
    "metadata",
    "maintenance",
    "past-performances"
  ],
  "steps": [
    {
      "name": "discover_configs",
      "function": "discover_data_sources",
      "params": {
        "source_type": "sharepoint"
      },
      "on_error": "fail",
      "condition": null,
      "description": "Find the Growth SharePoint sync configuration to get site name",
      "foreach": null,
      "branches": null
    },
    {
      "name": "find_assets",
      "function": "search_assets",
      "params": {
        "limit": 200,
        "query": "*",
        "where": [
          {
            "op": "is_empty",
            "field": "sharepoint.site_name"
          }
        ],
        "folder_path": "sharepoint/growth-sharepoint/reuse-material/past-performances",
        "source_type": "sharepoint",
        "sync_config_id": "d88142cb-c117-4296-8884-c069b3139dc8",
        "folder_match_mode": "prefix"
      },
      "on_error": "fail",
      "condition": null,
      "description": "Find assets in the Past Performances folder that are missing site_name",
      "foreach": null,
      "branches": null
    },
    {
      "name": "update_assets",
      "function": "foreach",
      "params": {
        "items": "{{ steps.find_assets }}"
      },
      "on_error": "continue",
      "condition": null,
      "description": "Set site_name in source_metadata.sharepoint for each asset and propagate to search index",
      "foreach": null,
      "branches": {
        "each": [
          {
            "name": "update_metadata",
            "function": "update_source_metadata",
            "params": {
              "fields": {
                "site_name": "Growth"
              },
              "asset_id": "{{ item.id }}",
              "namespace": "sharepoint",
              "propagate_to_search": true
            },
            "on_error": "continue",
            "condition": null,
            "description": "Update site_name for this asset",
            "foreach": null,
            "branches": null
          }
        ]
      }
    }
  ],
  "outputs": [
    {
      "type": "result",
      "config": {
        "include_steps": [
          "discover_configs",
          "process_configs"
        ]
      }
    }
  ],
  "version": "2.0.0",
  "on_error": "fail",
  "triggers": [],
  "parameters": [],
  "description": "Discover all SharePoint sync configs, resolve each site's display name via Microsoft Graph API, then propagate site_name to all linked assets' source_metadata.sharepoint and the search index. No parameters required \u2014 processes all active configs automatically."
}
