{
  "name": "SharePoint Proposals Classifier",
  "slug": "sharepoint_proposals",
  "description": "Processes documents from SharePoint sync to identify proposals and extract\nkey metadata like solicitation numbers, due dates, and pricing information.\n",
  "version": "1.0.0",
  "parameters": [
    {
      "name": "sync_config_id",
      "type": "str",
      "description": "SharePoint sync configuration ID",
      "required": true
    },
    {
      "name": "min_confidence",
      "type": "float",
      "description": "Minimum confidence for classification",
      "default": 0.7
    }
  ],
  "stages": [
    {
      "name": "gather_documents",
      "type": "gather",
      "function": "query_model",
      "description": "Get documents from SharePoint sync",
      "params": {
        "model": "SharePointSyncedDocument",
        "filters": {
          "sync_config_id": "{{ params.sync_config_id }}",
          "status": "synced"
        },
        "return_fields": [
          "id",
          "asset_id",
          "sharepoint_path",
          "filename",
          "content_type"
        ]
      }
    },
    {
      "name": "classify_documents",
      "type": "transform",
      "function": "classify_document",
      "description": "Classify each document by type",
      "batch_size": 10,
      "on_error": "continue",
      "params": {
        "persist": false
      }
    },
    {
      "name": "filter_proposals",
      "type": "filter",
      "function": "filter_by_field",
      "description": "Keep only proposal-type documents",
      "params": {
        "field": "document_type",
        "values": [
          "Proposal Response",
          "Statement of Work",
          "Pricing & Cost Data"
        ],
        "min_confidence": "{{ params.min_confidence }}"
      }
    },
    {
      "name": "extract_proposal_details",
      "type": "enrich",
      "function": "llm_extract",
      "description": "Extract proposal metadata",
      "batch_size": 5,
      "on_error": "continue",
      "params": {
        "schema": {
          "type": "object",
          "properties": {
            "solicitation_number": {
              "type": "string",
              "description": "Government solicitation or RFP number"
            },
            "due_date": {
              "type": "string",
              "description": "Proposal submission deadline"
            },
            "agency": {
              "type": "string",
              "description": "Contracting agency name"
            },
            "contract_type": {
              "type": "string",
              "description": "Contract type (FFP, T&M, CPFF, etc.)"
            },
            "estimated_value": {
              "type": "number",
              "description": "Estimated contract value if mentioned"
            }
          }
        },
        "system_prompt": "Extract proposal metadata from the document content. Look for:\n- Solicitation/RFP numbers (e.g., W912HZ-24-R-0001, FA8702-24-Q-1234)\n- Submission deadlines\n- Contracting agency\n- Contract type indicators\n- Any mentioned contract values\n"
      }
    },
    {
      "name": "update_asset_metadata",
      "type": "output",
      "function": "bulk_update_metadata",
      "description": "Save extracted metadata to assets",
      "params": {
        "field_mapping": {
          "document_type": "classification.document_type",
          "classification_confidence": "classification.confidence",
          "solicitation_number": "extraction.solicitation_number",
          "due_date": "extraction.due_date",
          "agency": "extraction.agency",
          "contract_type": "extraction.contract_type",
          "estimated_value": "extraction.estimated_value"
        },
        "tag_prefix": "proposal"
      }
    }
  ],
  "triggers": [
    {
      "type": "event",
      "event_name": "sharepoint_sync.completed",
      "event_filter": {
        "status": "completed"
      }
    }
  ],
  "on_error": "continue",
  "checkpoint_after_stages": [
    "gather_documents",
    "classify_documents"
  ],
  "tags": [
    "sharepoint",
    "proposals",
    "classification"
  ]
}