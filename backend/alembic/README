Alembic Database Migrations for Curatore v2
============================================

This directory contains Alembic database migrations for the Curatore v2 multi-tenant persistence layer.

## Running Migrations

### Create a new migration

```bash
# Auto-generate migration from model changes
cd backend
alembic revision --autogenerate -m "Description of changes"

# Create empty migration template
alembic revision -m "Description of changes"
```

### Apply migrations

```bash
# Upgrade to latest version
alembic upgrade head

# Upgrade to specific version
alembic upgrade <revision_id>

# Downgrade one version
alembic downgrade -1

# Downgrade to specific version
alembic downgrade <revision_id>
```

### View migration history

```bash
# Show current version
alembic current

# Show migration history
alembic history

# Show pending migrations
alembic history --verbose
```

## Initial Setup

The initial migration creates all tables for the multi-tenant architecture:
- organizations (tenants with settings)
- users (authentication and authorization)
- api_keys (headless/backend authentication)
- connections (runtime-configurable service connections)
- system_settings (global configuration)
- audit_logs (action tracking)

## Environment Variables

Migrations read the database URL from the `DATABASE_URL` environment variable:

```bash
# SQLite (development)
DATABASE_URL=sqlite+aiosqlite:///./data/curatore.db

# PostgreSQL (production)
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/curatore
```

## Migration Best Practices

1. **Always review autogenerated migrations** - Alembic may not detect all changes correctly
2. **Test migrations on a copy of production data** - Ensure data integrity
3. **Provide downgrade scripts** - Allow rollback if needed
4. **Keep migrations small and focused** - One logical change per migration
5. **Never edit applied migrations** - Create a new migration instead
