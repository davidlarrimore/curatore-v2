# ============================================================================
# Curatore v2 - Environment Configuration
# ============================================================================
# Copy this file to .env and customize for your deployment.
# All settings have sensible defaults; customize as needed for your use case.
# ============================================================================

# ============================================================================
# API / CORS SETTINGS
# ============================================================================

# DEBUG: Enable verbose logging and development helpers
#   - true: Detailed logs, stack traces, dev tools enabled
#   - false: Production mode with minimal logging
DEBUG=false

# CORS_ORIGINS: Allowed origins for cross-origin requests (JSON array format)
#   Example: ["http://localhost:3000","http://127.0.0.1:3000"]
CORS_ORIGINS=["http://localhost:3000"]


# ============================================================================
# LLM CONFIGURATION
# ============================================================================
# The LLM is used for document quality evaluation (clarity, completeness, etc.)

# OPENAI_API_KEY: Your API key for the LLM service
#   - Required for LLM evaluation features
#   - Supports OpenAI, Ollama, OpenWebUI, LM Studio, and compatible endpoints
OPENAI_API_KEY=put-your-openai-api-key-here

# OPENAI_MODEL: Model name to use for evaluations
#   - OpenAI: gpt-4o-mini, gpt-4o, gpt-4-turbo, gpt-3.5-turbo
#   - Ollama: llama3, mistral, mixtral, etc.
#   - Recommendation: gpt-4o-mini for best cost/performance balance
OPENAI_MODEL=gpt-4o-mini

# OPENAI_BASE_URL: LLM API endpoint
#   - OpenAI: https://api.openai.com/v1
#   - Ollama: http://localhost:11434/v1
#   - OpenWebUI: http://localhost:3000/v1
#   - LM Studio: http://localhost:1234/v1
OPENAI_BASE_URL=https://api.openai.com/v1

# OPENAI_VERIFY_SSL: Verify SSL certificates for LLM API calls
#   - true: Verify certificates (recommended for production)
#   - false: Skip verification (useful for self-signed certs in dev)
OPENAI_VERIFY_SSL=true

# OPENAI_TIMEOUT: Request timeout in seconds for LLM API calls
#   - Default: 60 seconds
#   - Increase for slower models or large documents
OPENAI_TIMEOUT=60

# OPENAI_MAX_RETRIES: Number of retry attempts for failed LLM API calls
#   - Default: 3 retries
#   - Set to 0 to disable retries
OPENAI_MAX_RETRIES=3


# ============================================================================
# OCR CONFIGURATION
# ============================================================================
# Used by extraction service for image-based PDFs and scanned documents

# OCR_LANG: Tesseract OCR language code
#   - eng: English
#   - spa: Spanish
#   - fra: French
#   - deu: German
#   - Multiple languages: eng+spa+fra
#   - Full list: https://github.com/tesseract-ocr/tessdata
OCR_LANG=eng

# OCR_PSM: Tesseract Page Segmentation Mode
#   - 3: Fully automatic page segmentation (default, recommended)
#   - 6: Uniform block of text
#   - 11: Sparse text (find as much text as possible)
#   - Full list: https://tesseract-ocr.github.io/tessdoc/ImproveQuality.html#page-segmentation-method
OCR_PSM=3


# ============================================================================
# FILE STORAGE CONFIGURATION
# ============================================================================
# Paths are INSIDE containers; docker-compose bind-mounts ./files -> /app/files

# FILES_ROOT: Root directory for all file storage
FILES_ROOT=/app/files

# UPLOAD_DIR: Directory for user-uploaded files
UPLOAD_DIR=/app/files/uploaded_files

# PROCESSED_DIR: Directory for processed markdown output
PROCESSED_DIR=/app/files/processed_files

# BATCH_DIR: Directory for operator-provided bulk/test inputs
BATCH_DIR=/app/files/batch_files

# MAX_FILE_SIZE: Maximum upload size in bytes
#   - Default: 52428800 (50 MB)
#   - Formula: bytes = MB × 1024 × 1024
MAX_FILE_SIZE=52428800


# ============================================================================
# QUALITY THRESHOLDS
# ============================================================================
# All thresholds must be met for a document to be marked "RAG Ready"

# DEFAULT_CONVERSION_THRESHOLD: Conversion quality score (0-100 scale)
#   - 70+: Good quality extraction
#   - 80+: Excellent quality extraction
#   - 90+: Near-perfect extraction
DEFAULT_CONVERSION_THRESHOLD=70

# DEFAULT_CLARITY_THRESHOLD: Document clarity score (1-10 scale)
#   - How clear and understandable is the content?
#   - Evaluated by LLM
DEFAULT_CLARITY_THRESHOLD=7

# DEFAULT_COMPLETENESS_THRESHOLD: Content completeness score (1-10 scale)
#   - How complete is the extracted content?
#   - Evaluated by LLM
DEFAULT_COMPLETENESS_THRESHOLD=7

# DEFAULT_RELEVANCE_THRESHOLD: Content relevance score (1-10 scale)
#   - How relevant is the content for RAG use cases?
#   - Evaluated by LLM
DEFAULT_RELEVANCE_THRESHOLD=7

# DEFAULT_MARKDOWN_THRESHOLD: Markdown quality score (1-10 scale)
#   - How well-formatted is the markdown output?
#   - Evaluated by LLM
DEFAULT_MARKDOWN_THRESHOLD=7


# ============================================================================
# CELERY / REDIS CONFIGURATION
# ============================================================================
# Background job processing and task queue management

# CELERY_DEFAULT_QUEUE: Queue name for processing tasks
CELERY_DEFAULT_QUEUE=processing

# CELERY_BROKER_URL: Redis URL for task queue broker
#   - Format: redis://hostname:port/db
#   - Default uses service name from docker-compose
CELERY_BROKER_URL=redis://redis:6379/0

# CELERY_RESULT_BACKEND: Redis URL for storing task results
#   - Uses separate database (1) from broker (0)
CELERY_RESULT_BACKEND=redis://redis:6379/1


# ============================================================================
# EXTRACTION SERVICE CONFIGURATION
# ============================================================================
# Settings for document-to-markdown conversion services

# EXTRACTION_SERVICE_TIMEOUT: Timeout in seconds for extraction API calls
#   - Default: 180 seconds (3 minutes)
#   - With retries: 180s → 210s → 240s (progressive timeout extension)
#   - Large PDFs or OCR-heavy documents may need longer timeouts
EXTRACTION_SERVICE_TIMEOUT=180

# DOCLING_TIMEOUT: Timeout in seconds for Docling service API calls
#   - Default: 300 seconds (5 minutes)
#   - Docling processes complex layouts and may take longer than basic extraction
DOCLING_TIMEOUT=300

# DOCLING_SERVE_MAX_SYNC_WAIT: Maximum wait time for Docling synchronous operations
#   - Only applicable when using Docling service
DOCLING_SERVE_MAX_SYNC_WAIT=300


# ============================================================================
# EXTRACTION ENGINE CONFIGURATION
# ============================================================================

# ENABLE_DOCLING_SERVICE: Start Docling service container
#   - true: Start Docling container (requires more resources)
#   - false: Disable Docling (extraction-service only)
#   - Used by docker-compose profiles
ENABLE_DOCLING_SERVICE=false

# EXTRACTION_ENGINES: Space or comma-separated list of engines to start
#   - "default": Internal extraction-service (always runs)
#   - "docling": Docling Serve (requires ENABLE_DOCLING_SERVICE=true)
#   - Example: "default docling" enables both
#   - Note: "default" always runs; this setting adds additional engines
EXTRACTION_ENGINES="default"

# CONTENT_EXTRACTOR: Active extraction engine selection
#   Options:
#     - auto: Intelligent selection (prefers Docling if available, falls back to default)
#             Best for: Production with both services enabled
#             Behavior: Docling (3 retries) → extraction-service (3 retries)
#
#     - default: Use extraction-service (internal microservice)
#             Best for: Standard deployments, lighter resource usage
#             Behavior: extraction-service (3 retries) → Docling failover if enabled
#             Features: Fast, handles most documents, OCR support
#
#     - docling: Use Docling Serve (external service)
#             Best for: Complex PDFs, Office docs with rich layouts
#             Behavior: Docling (3 retries) → extraction-service failover if enabled
#             Features: Advanced layout analysis, table extraction, formula support
#
#     - none: Disable extraction (returns placeholder text)
#             Best for: Testing or markdown-only workflows
#
#   Retry Logic (applies to all engines):
#     - Each engine attempts extraction up to 3 times
#     - Timeouts increase by 30s per retry (180s → 210s → 240s)
#     - On total failure, failover to alternate engine (if available)
#     - Example with auto: Up to 6 total attempts (3 Docling + 3 extraction-service)
CONTENT_EXTRACTOR=default
